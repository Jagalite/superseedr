services:
  gluetun:
    image: qmcgaw/gluetun
    container_name: gluetun
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    volumes:
      # Volume for Gluetun's internal data
      - gluetun-data:/gluetun
      # Shared volume to write the port file
      - forwarded-port:/tmp/gluetun
    environment:
      # --- VPN Service Provider ---
      - VPN_SERVICE_PROVIDER=private internet access
      - VPN_TYPE=openvpn
      
      # --- PIA Credentials (from .env file) ---
      - OPENVPN_USER=${PIA_USER}
      - OPENVPN_PASSWORD=${PIA_PASS}
      
      # --- Dynamic Port Forwarding ---
      - PORT_FORWARDING=on
      
      # --- Server Selection ---
      # 'Iceland' is based on the 'is.privacy.network' from your old vpn.conf
      # You can change this to any region PIA supports
      - SERVER_REGIONS=Iceland
      
      # --- DNS ---
      - DOT=on
      
    restart: unless-stopped

  superseedr:
    extends:
      file: docker-compose.common.yml
      service: superseedr
    # This attaches superseedr to gluetun's network
    network_mode: "service:gluetun"
    depends_on: [gluetun]
    volumes:
      # --- App Volumes (from common.yml) ---
      - ${HOST_SUPERSEEDR_DATA_PATH:-superseedr-data}:/superseedr-data
      - ${HOST_SUPERSEEDR_CONFIG_PATH:-superseedr-config}:/root/.config/jagalite.superseedr
      - ${HOST_SUPERSEEDR_SHARE_PATH:-superseedr-share}:/root/.local/share/jagalite.superseedr
      
      # --- Shared Port Volume ---
      # This is where superseedr reads the port file
      - forwarded-port:/port-data

# Define all the volumes used
volumes:
  superseedr-data:
  superseedr-config:
  superseedr-share:
  gluetun-data:
  forwarded-port:
